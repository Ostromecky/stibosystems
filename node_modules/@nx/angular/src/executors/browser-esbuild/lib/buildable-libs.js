"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTmpTsConfigForBuildableLibs = void 0;
const buildable_libs_utils_1 = require("@nx/js/src/utils/buildable-libs-utils");
const path_1 = require("path");
const devkit_1 = require("@nx/devkit");
function createTmpTsConfigForBuildableLibs(tsConfigPath, context, options) {
    var _a, _b;
    let dependencies;
    const result = (0, buildable_libs_utils_1.calculateProjectDependencies)((_a = options === null || options === void 0 ? void 0 : options.projectGraph) !== null && _a !== void 0 ? _a : (0, devkit_1.readCachedProjectGraph)(), context.root, context.projectName, (_b = options === null || options === void 0 ? void 0 : options.target) !== null && _b !== void 0 ? _b : context.targetName, context.configurationName);
    dependencies = result.dependencies;
    const tmpTsConfigPath = (0, buildable_libs_utils_1.createTmpTsConfig)((0, path_1.join)(context.root, tsConfigPath), context.root, result.target.data.root, dependencies);
    process.env.NX_TSCONFIG_PATH = tmpTsConfigPath;
    // Angular EsBuild Builder appends the workspaceRoot to the config path, so remove it.
    const tmpTsConfigPathWithoutWorkspaceRoot = tmpTsConfigPath.replace(context.root, '');
    return { tsConfigPath: tmpTsConfigPathWithoutWorkspaceRoot, dependencies };
}
exports.createTmpTsConfigForBuildableLibs = createTmpTsConfigForBuildableLibs;
