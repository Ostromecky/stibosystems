const a3_0x1498=['../../../utilities/axios','headers','readFileSync','response','RunStart\x20duration','runUrl','getBranch','api','getRunGroup','error','package.json','RunEnd\x20duration','slice','extractErrorMessage','apiAxiosInstance','createReqBody','unknown','message','../../../utilities/environment','nx-cloud','from','printDuration','urls','mapRespToPerfEntry','stack','terminalOutput','Invalid\x20Nx\x20Cloud\x20response:\x20','data','isConnectedToPrivateCloud','apply','nxCloudVersion','success','getCIExecutionEnv','throw','next','status','stringify','defaults','Invalid\x20end\x20run\x20response','recordMetric','endRun','note','__awaiter','CloudRunApi','machineInfo','parse','/nx-cloud/runs/start','../../../utilities/nx-imports-light','apiError','assign','createMetricRecorder','map','devDependencies','Invalid\x20end\x20run\x20response:\x20','axiosException','zlib','toString','createApiAxiosInstance','done','then','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','post','VERBOSE_LOGGING','...','startRun','defineProperty','getCIExecutionId','messages','application/octet-stream','gzip','Run\x20Details:','util','Run\x20completion\x20responded\x20with\x20`undefined`.','runContext','__esModule','axiosMultipleTries','string'];(function(_0x1b6668,_0x1498d5){const _0x205c2d=function(_0x2581cd){while(--_0x2581cd){_0x1b6668['push'](_0x1b6668['shift']());}};_0x205c2d(++_0x1498d5);}(a3_0x1498,0xd7));const a3_0x205c=function(_0x1b6668,_0x1498d5){_0x1b6668=_0x1b6668-0x0;let _0x205c2d=a3_0x1498[_0x1b6668];return _0x205c2d;};'use strict';var __awaiter=this&&this[a3_0x205c('0x3a')]||function(_0x2ed52b,_0x54a5d7,_0x27ac70,_0x510d70){function _0x4f1a5a(_0x14b1f8){return _0x14b1f8 instanceof _0x27ac70?_0x14b1f8:new _0x27ac70(function(_0x1fb62b){_0x1fb62b(_0x14b1f8);});}return new(_0x27ac70||(_0x27ac70=Promise))(function(_0x2dabe1,_0x14f919){function _0x249f04(_0x3cd92d){try{_0x44d7e2(_0x510d70['next'](_0x3cd92d));}catch(_0x11d689){_0x14f919(_0x11d689);}}function _0x5ba5cd(_0x386346){try{_0x44d7e2(_0x510d70[a3_0x205c('0x31')](_0x386346));}catch(_0x4d1d48){_0x14f919(_0x4d1d48);}}function _0x44d7e2(_0x4ef056){_0x4ef056[a3_0x205c('0x4a')]?_0x2dabe1(_0x4ef056['value']):_0x4f1a5a(_0x4ef056['value'])[a3_0x205c('0x4b')](_0x249f04,_0x5ba5cd);}_0x44d7e2((_0x510d70=_0x510d70[a3_0x205c('0x2d')](_0x2ed52b,_0x54a5d7||[]))[a3_0x205c('0x32')]());});};Object[a3_0x205c('0x4')](exports,a3_0x205c('0xd'),{'value':!![]});exports[a3_0x205c('0x3b')]=void 0x0;const axios_1=require(a3_0x205c('0x10'));const environment_1=require(a3_0x205c('0x22'));const fs_1=require('fs');const zlib_1=require(a3_0x205c('0x47'));const util_1=require(a3_0x205c('0xa'));const metric_logger_1=require('../../../utilities/metric-logger');const is_private_cloud_1=require('../../../utilities/is-private-cloud');const {output}=require(a3_0x205c('0x3f'));class CloudRunApi{constructor(_0x175543,_0x52caae,_0x5ec923,_0x13ee70){this[a3_0x205c('0x6')]=_0x175543;this[a3_0x205c('0xc')]=_0x52caae;this[a3_0x205c('0x3c')]=_0x13ee70;this[a3_0x205c('0x1e')]=(0x0,axios_1[a3_0x205c('0x49')])(_0x5ec923);}[a3_0x205c('0x3')](_0x262362,_0x424745){var _0x177e74;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x205c('0x6')]['apiError'])return{};const _0x22c9b4=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x205c('0x3'));try{const _0x7e30e4={'meta':{'nxCloudVersion':this[a3_0x205c('0x2e')]()},'branch':(0x0,environment_1[a3_0x205c('0x16')])(),'runGroup':(0x0,environment_1[a3_0x205c('0x18')])(),'ciExecutionId':(0x0,environment_1[a3_0x205c('0x5')])(),'ciExecutionEnv':(0x0,environment_1[a3_0x205c('0x30')])(),'distributedExecutionId':_0x262362,'hashes':_0x424745};if(environment_1[a3_0x205c('0x1')]){output[a3_0x205c('0x39')]({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x205c('0x34')](_0x7e30e4,null,0x2)]});}const _0xcc00f8=yield(0x0,axios_1[a3_0x205c('0x25')])(a3_0x205c('0x14'),()=>(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x205c('0x1e')][a3_0x205c('0x0')](a3_0x205c('0x3e'),_0x7e30e4)));_0x22c9b4[a3_0x205c('0x37')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0xcc00f8));if(_0xcc00f8[a3_0x205c('0x2b')]&&_0xcc00f8['data']['message']){this[a3_0x205c('0x6')][a3_0x205c('0x21')]=_0xcc00f8[a3_0x205c('0x2b')][a3_0x205c('0x21')];}if(!_0xcc00f8[a3_0x205c('0x2b')]||!_0xcc00f8['data'][a3_0x205c('0x26')]){this[a3_0x205c('0x6')][a3_0x205c('0x40')]=a3_0x205c('0x2a')+JSON['stringify'](_0xcc00f8[a3_0x205c('0x2b')]);return{};}return _0xcc00f8['data'][a3_0x205c('0x26')];}catch(_0x56ed58){_0x22c9b4[a3_0x205c('0x37')](((_0x177e74=_0x56ed58===null||_0x56ed58===void 0x0?void 0x0:_0x56ed58['axiosException'])===null||_0x177e74===void 0x0?void 0x0:_0x177e74[a3_0x205c('0x13')])?(0x0,metric_logger_1[a3_0x205c('0x27')])(_0x56ed58[a3_0x205c('0x46')][a3_0x205c('0x13')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this[a3_0x205c('0x6')][a3_0x205c('0x40')]=this['messages'][a3_0x205c('0x1d')](_0x56ed58,a3_0x205c('0x17'));return{};}});}[a3_0x205c('0x1f')](_0x3f7d94,_0x4a3a64,_0x18139c,_0x1faa29){if((0x0,is_private_cloud_1[a3_0x205c('0x2c')])()){for(let _0x1fb5a1 of _0x4a3a64){delete _0x1fb5a1['uploadedToStorage'];}}const _0x4f42c=Object['assign'](Object[a3_0x205c('0x41')]({'meta':{'nxCloudVersion':this[a3_0x205c('0x2e')]()},'tasks':_0x4a3a64,'run':_0x3f7d94,'linkId':_0x1faa29},(0x0,is_private_cloud_1[a3_0x205c('0x2c')])()?{}:_0x18139c),{'machineInfo':this[a3_0x205c('0x3c')]});return JSON[a3_0x205c('0x34')](_0x4f42c);}[a3_0x205c('0x38')](_0x3c0e12,_0x2fe61d,_0x127a2f,_0x12cd00){var _0x53d928,_0x45457d;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x205c('0x6')][a3_0x205c('0x40')])return![];let _0x531c0a=this[a3_0x205c('0x1f')](_0x3c0e12,_0x2fe61d,_0x127a2f,_0x12cd00);if(_0x531c0a['length']>0x14*0x3e8*0x3e8){_0x531c0a=this[a3_0x205c('0x1f')](_0x3c0e12,_0x2fe61d[a3_0x205c('0x43')](_0x1b070d=>Object[a3_0x205c('0x41')](Object[a3_0x205c('0x41')]({},_0x1b070d),{'hashDetails':undefined})),_0x127a2f,_0x12cd00);}const _0x3f82fd=Buffer[a3_0x205c('0x24')](_0x531c0a);const _0x5d34de=yield(0x0,util_1['promisify'])(zlib_1['gzip'])(_0x3f82fd);const _0x108f8c=(0x0,metric_logger_1[a3_0x205c('0x42')])('endRun');try{if(environment_1[a3_0x205c('0x1')]){const _0x1b98b0=_0x2fe61d[a3_0x205c('0x43')](_0x5bf6e8=>{return Object[a3_0x205c('0x41')](Object[a3_0x205c('0x41')]({},_0x5bf6e8),{'terminalOutput':_0x5bf6e8[a3_0x205c('0x29')]?_0x5bf6e8[a3_0x205c('0x29')][a3_0x205c('0x1c')](0x0,0x14)+a3_0x205c('0x2'):undefined});});output['note']({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON['stringify'](_0x1b98b0,null,0x2)]});}const _0x4003a5=yield(0x0,axios_1[a3_0x205c('0x25')])(a3_0x205c('0x1b'),()=>(0x0,axios_1[a3_0x205c('0xe')])(()=>this[a3_0x205c('0x1e')][a3_0x205c('0x0')]('/nx-cloud/runs/end',_0x5d34de,{'headers':Object[a3_0x205c('0x41')](Object[a3_0x205c('0x41')]({},this[a3_0x205c('0x1e')][a3_0x205c('0x35')][a3_0x205c('0x11')]),{'Content-Encoding':a3_0x205c('0x8'),'Content-Type':a3_0x205c('0x7')})})));if(_0x4003a5){_0x108f8c['recordMetric']((0x0,metric_logger_1[a3_0x205c('0x27')])(_0x4003a5));if(_0x4003a5[a3_0x205c('0x2b')]&&_0x4003a5['data']['runUrl']&&_0x4003a5[a3_0x205c('0x2b')][a3_0x205c('0x33')]===a3_0x205c('0x2f')){this[a3_0x205c('0xc')]['runUrl']=_0x4003a5['data'][a3_0x205c('0x15')];return!![];}if(_0x4003a5[a3_0x205c('0x2b')]&&_0x4003a5[a3_0x205c('0x2b')][a3_0x205c('0x33')]){this['messages']['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x205c('0x34')](_0x4003a5['data'][a3_0x205c('0x21')]);}else if(_0x4003a5[a3_0x205c('0x2b')]&&typeof _0x4003a5[a3_0x205c('0x2b')]===a3_0x205c('0xf')){if(_0x4003a5[a3_0x205c('0x2b')]!==a3_0x205c('0x2f')){this[a3_0x205c('0x6')][a3_0x205c('0x40')]=a3_0x205c('0x45')+JSON['stringify'](_0x4003a5[a3_0x205c('0x2b')]);}}else{this['messages'][a3_0x205c('0x40')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x205c('0x34')](_0x4003a5[a3_0x205c('0x2b')]);}if(environment_1[a3_0x205c('0x1')]){output[a3_0x205c('0x39')]({'title':a3_0x205c('0x36'),'bodyLines':[JSON[a3_0x205c('0x34')](_0x4003a5[a3_0x205c('0x2b')],null,0x2)]});}}else{output[a3_0x205c('0x19')]({'title':a3_0x205c('0x4c'),'bodyLines':[a3_0x205c('0xb'),a3_0x205c('0x9'),JSON[a3_0x205c('0x34')](_0x3c0e12,null,0x2),'Stack\x20Trace:',JSON[a3_0x205c('0x34')](new Error()[a3_0x205c('0x28')],null,0x2)]});}return![];}catch(_0x5251cb){_0x108f8c[a3_0x205c('0x37')](((_0x53d928=_0x5251cb===null||_0x5251cb===void 0x0?void 0x0:_0x5251cb[a3_0x205c('0x46')])===null||_0x53d928===void 0x0?void 0x0:_0x53d928['response'])?(0x0,metric_logger_1[a3_0x205c('0x27')])(_0x5251cb[a3_0x205c('0x46')]['response']):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);const _0x57463a=(_0x45457d=_0x5251cb['axiosException'])!==null&&_0x45457d!==void 0x0?_0x45457d:_0x5251cb;this[a3_0x205c('0x6')]['apiError']=this[a3_0x205c('0x6')]['extractErrorMessage'](_0x57463a,'api');return![];}});}[a3_0x205c('0x2e')](){try{const _0x406b70=JSON[a3_0x205c('0x3d')]((0x0,fs_1[a3_0x205c('0x12')])(a3_0x205c('0x1a'))[a3_0x205c('0x48')]());return _0x406b70['devDependencies'][a3_0x205c('0x23')]||_0x406b70[a3_0x205c('0x44')]['@nrwl/nx-cloud'];}catch(_0x220e6b){return a3_0x205c('0x20');}}}exports[a3_0x205c('0x3b')]=CloudRunApi;